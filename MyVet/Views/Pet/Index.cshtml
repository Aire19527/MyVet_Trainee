@model IEnumerable<MyVet.Domain.Dto.PetDto>

@{
    ViewData["Title"] = "Mis Mascotas";
}

<h1>Listado de mascotas</h1>


<p>
    
    <button class="btn btn-primary" onclick="nuevaMascota()">

        <i class="fas fa-paw"></i> Nuevo Mascota
    </button>
</p>

<div class="row">

    <table class="table">
        <thead class="thead-dark">
            <tr>
                <th scope="col">Nombre</th>
                <th scope="col">Edad</th>
                <th scope="col">Tipo</th>
                <th scope="col">Sexo</th>
                <th scope="col">Opciones</th>
            </tr>
        </thead>
       
        <tbody id="cuerpoPets"></tbody>
    </table>

</div>


<!-- Vertically centered scrollable modal -->
<div  class="modal-dialog modal-dialog-centered modal-dialog-scrollable" id="modalGuardarPet">
  
</div>

<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">New message</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label for="recipient-name" class="col-form-label">Recipient:</label>
            <input type="text" class="form-control" id="recipient-name">
          </div>
          <div class="mb-3">
            <label for="message-text" class="col-form-label">Message:</label>
            <textarea class="form-control" id="message-text"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Send message</button>
      </div>
    </div>
  </div>
</div>


@section Scripts{
<script type="text/javascript" charset="utf-8">

    var listaPets= JSON.parse('@Json.Serialize(@Model)');
    $(document).ready(function () {
        console.log("Hola mundo");
        console.log(listaPets);
        cargarGridPets(listaPets);
    });

    function eliminarPet(idPet)
    {
        console.log("mandó a eliminar",idPet);
        Swal.fire({
            title: '¿Confirmar Eliminacion?',
            text: "No podrás revertir esto.!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            cancelButtonText: 'Cancelar',
            confirmButtonText: 'Si, Eliminar!',
        }).then((result) => {
            if (result.isConfirmed) {
                //petición 
                $.ajax({
                    url: '@Url.Action("DeletePet", "Pet")',
                    method: 'DELETE',
                    data:{
                        idPet:idPet
                    },
                    dataType: "json",
                    success: function (data) {
                        console.log(data);
                        if (data.isSuccess){
                            
                            listaPets=listaPets.filter(x=>x.id!=idPet);
                            cargarGridPets(listaPets);

                            Swal.fire(
                                'Eliminado!',
                                data.message,
                                'success');
                        }else{
                            Swal.fire(
                                'Error!',
                                data.message,
                                'error');
                        }
                     },
                     error: function (xhr, textStatus, errorThrown) {
                         console.error(xhr, textStatus, errorThrown);
                     }
                  });
                }

            });
        }

    function cargarGridPets(data){
        $("#cuerpoPets").html("");

        for(var i=0; i<data.length; i++){
            var tr=`
             <tr>
                <th>`+ data[i].name+ `</th>
                <th> `+ data[i].edad +`</th>
                <th> `+ data[i].typePet +`</th>
                <th> `+ data[i].sexo + `</th>
                <td>
                <button  class="btn btn-warning"><i class="fas fa-edit"></i> Editar</button>
                <button class="btn btn-danger" onclick="eliminarPet(`+ data[i].id +`)"><i class="far fa-trash-alt"></i> Eliminar</button>
                </td>
            </tr>
            `;
            $("#cuerpoPets").append(tr);
        }
    }

    function nuevaMascota(){
        console.log("crear mascota");
       //$('#exampleModal').show()
       $('#exampleModal').modal({keyboard:false});

    }

</script>
}
